# Primus Live

This is a simple development setup for Node.js apps, with minimal dependency
on other packages and maximal freedom to organise the app's source files:

* uses [Primus][P] to manage a WebSocket connection between server and client
* uses [Connect][N] to serve all static files in the `app/` folder
* can compile [Jade][J] (.jade) and [MarkDown][M] (.md) files to HMTL (.html)
* can compile [Stylus][S] (.styl) files to CSS (.css)
* can compile [CoffeeScript][C] (.coffee) files to JavaScript (.js)
* clients do not care about this, they just fetch .html, .css, and .js files
* the server tells each client to reload HTML or refresh CSS when a file changes
* the server also restarts _itself_ whenever a source code file changes
* supports optional plugins to include custom server- and/or client-side logic
* automatic WebSocket reconnect with back-off (handled by Primus)

## Example

This minimal example connects and reports tick events from the server.  This
uses Jade, Stylus, and CoffeeScript, but HTML, CSS, and JavaScript also work:

### app/index.jade

```
!!!
html(lang='en')
  head
    meta(charset='utf-8')
    script(src='/primus/primus.js')
    script(src='/app.js')

    title Primus Live Example
    link(rel='stylesheet',href='/style.css')

  body
    p
      | Server time is: 
      span#tick ?
```

### app/style.css

```stylus
body
  margin 50px
```

### app/app.coffee

```coffee
# make Primus object global for console debugging
window.primus = new Primus

primus.on 'data', (data) ->
  if typeof data is 'number'
    el = document.getElementById 'tick'
    el.innerHTML = new Date(data)
```

## Startup

Launch the server as follows and then go to <http://localhost:8080/>:

```
  cd example
  node ..
```

It will keep running, compiling (in memory) and serving files as needed. Touch
or change any of the files in the `app/` folder to see live-reload in action.

### primus.js

This transport-specific wrapper (here [engine.io][E]) is generated by Primus.
It also includes the client-side code of all plugins, so they can be initialised
when the Primus connection object is created on the client.

## Plugins

If there are subdirectories in './app', these will be used to define additional
plugins. Put server side code in a file named 'server.coffee' (or .js), and put
client-side code in a file called 'client.coffee' and things will automatically
get picked up, i.e. launched on the server and/or sent and run on the clients.

The server-side code must export a single function taking `primus` as single
argument, because that's how Primus expects server-side plugins to be.

The client-side code can be anything, it is sent over and run as is (note that
this happens _before_ the Primus instance gets created in `app/app.js`).

## Your own app

To customise, make a copy of the `example/` folder next to it and change things
there, so that updates of this code won't get in your way.

Load `primus.js` followed by a `new Primus();` on each page load to keep a
real-time bi-directional WebSocket connection open, including the automatic
live-reload. This is is particularly easy to do with single-page applications.

Live-reload is implemented by sending `true` or `false` over the WebSocket
(as JSON). These two values should be ignored in your own code when listening
for `data` events on the `primus` object.

## License

MIT

[A]: http://angularjs.org/
[B]: http://bower.io/
[C]: http://coffeescript.org/
[E]: https://github.com/LearnBoost/engine.io
[F]: http://foundation.zurb.com/
[G]: https://github.com/3rd-Eden/primus#plugins
[J]: http://jade-lang.com/
[M]: http://daringfireball.net/projects/markdown/
[N]: http://www.senchalabs.org/connect/
[P]: https://medium.com/the-build/22af5c94a922
[S]: http://learnboost.github.io/stylus/
[X]: https://github.com/3rd-Eden/primus/tree/master/example
