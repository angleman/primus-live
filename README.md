Primus Live
===========

This is a simple development setup for Node.js apps, with minimal dependencies
on other packages and maximal freedom to organise the application source files:

* uses [Primus][P] to manage a WebSocket connection between server and client
* uses [node-static][N] to serve all static files in the `app/` folder
* can compile [Jade][J] (.jade) and [MarkDown][M] (.md) files to HMTL (.html)
* can compile [Stylus][S] (.styl) files to CSS (.css)
* can compile [CoffeeScript][C] (.coffee) files to JavaScript (.js)
* the clients do not notice this, they just fetch .html, .css, and .js files
* the server tells each client to reload or refresh CSS when a file changes
* automatic WebSocket reconnect with back-off (handled by Primus)

Example
-------

This example was adapted from the Primus [example][X] and converted to Jade,
Stylus, and CoffeeScript:

### app/index.jade

```jade
!!!
html(lang='en')
  head
    meta(charset='utf-8')
    title Primus Live
    script(src='/primus/primus.js')
    script(src='/reload/reload.js')
    link(rel='stylesheet',href='http://getbootstrap.com/dist/css/bootstrap.css')
    link(rel='stylesheet',media='all',href='app.css')

  body
    .jumbotron
      .container
        h1 Primus
        p.lead.
          Live reload demo with CoffeeScript, Jade, and Stylus auto-compilation.
        p#connect.btn.btn-outline-inverse.btn-lg connected
    #output
```

### Startup

Launch the server with this command:

```shell
  node server.js
```

It will keep running, serving files and translating (in memory) as needed.

Change any of the files in the `app/` folder to see live-reload in action.

### primus.js

This transport-specific wrapper is automatically generated by Primus.
This demo currently uses the [engine.io][E] transport.

### reload.js

This script is generated by the server (see `main.coffee`). It sets up a
WebSocket, initialises a global `primus` object, and sets up auto-reloading.

### Your own pages

Load `primus.js` and then `reload.js` on each page to keep a WebSocket-based
bi-directional real-time connection open, and to implement live reload.
This is is particularly easy to do with single-page applications.

To disable live-reloading, you can replace the `reload.js` script with:

```html
<script>window.primus = new Primus();</script>
```

Note: live-reload is implemented by sending `true` or `false` over the WebSocket
(as JSON). These two values should be ignored in your own code when listening
for `data` events on the `primus` object.

License
-------

MIT

[P]: https://medium.com/the-build/22af5c94a922
[J]: http://jade-lang.com/
[S]: http://learnboost.github.io/stylus/
[C]: http://coffeescript.org/
[M]: http://daringfireball.net/projects/markdown/
[E]: https://github.com/LearnBoost/engine.io
[X]: https://github.com/3rd-Eden/primus/tree/master/example
[N]: https://github.com/cloudhead/node-static
